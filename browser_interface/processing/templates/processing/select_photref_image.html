{% extends 'core/lcars_app.html' %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'processing/css/select_photref.css' %}"/>
{% endblock extra_head %}

{% block header_title %}{% block app_title %}
Select Photometric Reference
{% endblock %}{% endblock %}

{% block header_bar_extra %}
<div class="lcars-bar
            horizontal
            lcars-u-2">
    Intensity range:
</div>

<div class="lcars-bar horizontal spacer"></div>
{% if range != "minmax" %}
{% url 'processing:select_photref_image' target_index=target_index image_index=image_index values_range='minmax' values_transform=transform as updateURL %}
<div onclick="updateView('{{updateURL}}')"
     class="lcars-bar
             button
             horizontal
             lcars-chestnut-rose-bg
             lcars-u-1"
     >
     <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
         min/max
     </div>
</div>
<div class="lcars-bar horizontal spacer"></div>
{% endif %}

{% if range != "zscale" %}
{% url 'processing:select_photref_image' target_index=target_index image_index=image_index values_range='zscale' values_transform=transform as updateURL %}
<div onclick="updateView('{{updateURL}}')"
     class="lcars-bar
            button
            horizontal
            lcars-chestnut-rose-bg
            lcars-u-1">
    <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
        zscale
    </div>
</div>
<div class="lcars-bar horizontal spacer"></div>
{% endif %}

{% url 'processing:select_photref_image' target_index=target_index image_index=image_index|add:"-1" values_range=range values_transform=transform as updateURL %}
<div class="lcars-bar
            {% if image_index > 0 %}
            button
            {% endif %}
            horizontal
            lcars-melrose-bg
            lcars-u-2"
     {% if image_index > 0 %}
     onclick="updateView('{{updateURL}}')"
     {% endif %}
     >
    <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
        <<< prev. image
    </div>
</div>

<div class="lcars-bar horizontal spacer"></div>

{% url 'processing:select_photref_image' target_index=target_index image_index=image_index|add:"1" values_range=range values_transform=transform as updateURL %}
<div onclick="updateView('{{updateURL}}')"
     class="lcars-bar
            button
            horizontal
            lcars-melrose-bg
            lcars-u-2">
    <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
        next image >>>
    </div>
</div>

{% endblock header_bar_extra %}


{% block footer_bar_extra %}
<div class="lcars-bar
            bottom
            horizontal
            lcars-u-3">
    Transform intensity:
</div>

{% if transform %}
<div class="lcars-bar horizontal spacer"></div>
{% url 'processing:select_photref_image' target_index=target_index image_index=image_index values_range=range as updateURL %}
<div onclick="updateView('{{updateURL}}')"
     class="lcars-bar
            horizontal
            button
            bottom
            lcars-chestnut-rose-bg
            lcars-u-1"
     >
     <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
         None
     </div>
</div>
{% endif %}
<div class="lcars-bar horizontal spacer"></div>
{% for trans_choice in transform_list %}
{% if trans_choice != transform %}
{% url 'processing:select_photref_image' target_index=target_index image_index=image_index values_range=range values_transform=trans_choice as updateURL %}
<div onclick="updateView('{{updateURL}}')"
     class="lcars-bar
            button
            horizontal
            bottom
            lcars-chestnut-rose-bg
            lcars-u-1"
     >
     <div style="white-space: nowrap; margin-left: 1em; margin-right:1em">
         {{trans_choice}}
   </div>
</div>
<div class="lcars-bar horizontal spacer"></div>
{% endif %}
{% endfor %}
{% endblock footer_bar_extra %}

{% block left_menu %}
<a href="{% url 'processing:progress' %}">
    <div class="lcars-element 
                button 
                lcars-melrose-bg
                lcars-u-1-2">
        Set This Image As Reference
    </div>
</a>
{% url 'processing:select_photref_image_recalc' target_index=target_index image_index=image_index values_range=range values_transform=transform as updateURL %}
<div onclick="updateView('{{updateURL}}')">
    <div class="lcars-element 
                button 
                lcars-husk-bg
                lcars-u-1-1">
        Recalc. merit
    </div>
</div>
{% endblock left_menu %}


{% block main %}
<div id="full-view" class="lcars-row">
    <div class="main-parent"> 
        <img id="main-image" src="data:image/png;base64,{{image}}"></img>
    </div>
    <div id="side-bar" class="lcars-row lcars-u-2" style="overflow: hidden;">
        <div id="vert-hist-sep" class="lcars-column">
            <div id="hist-scroll-up" 
                 class="lcars-bracket top lcars-melrose-bg" 
                 style="height:30%">
            </div>
            <div id="resize-hist" class="lcars-bar" style="height:40%;"></div>
            <div id="hist-scroll-down"
                 class="lcars-bracket bottom lcars-melrose-bg" 
                 style="height:30%">
            </div>
        </div>
        <div id="hist-parent" class="lcars-col">
            {% for hist in histograms %}
            {{hist|safe}}
            {% endfor %}
        </div>
    </div>
</div>

<script src="{% static 'js/autowisp.util.js' %}"></script>

<script src="{% static 'processing/js/select.photref.js' %}"></script>

<script type="text/javascript">
    initView({{ view_config|safe }});
</script> 
{% endblock main %}
